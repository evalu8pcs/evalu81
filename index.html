<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Evalu8 Tender Pro</title>

<style>
body {
font-family: -apple-system;
margin: 20px;
background: #f2f2f7;
}
.card {
background: white;
padding: 20px;
border-radius: 16px;
margin-bottom: 10px;
box-shadow:0 6px 20px rgba(0,0,0,0.08);
}
h2 {margin-top:0;}
input, select {
width:100%;
padding:10px;
margin:6px 0;
border-radius:10px;
border:1px solid #ccc;
}
button {
width:100%;
padding:12px;
margin-top:8px;
border-radius:12px;
background:black;
color:white;
font-size:16px;
}
.slider {width:100%;}
.result {
margin-top:10px;
padding:10px;
background:#f9f9fb;
border-radius:10px;
}
</style>
</head>

<body>

<div class="card">
<h2>Evalu8 Tender Pro</h2>

<label>Mode</label>
<select id="mode">
<option value="forward">Cost → Tender</option>
<option value="reverse">Tender → Cost</option>
</select>

<label>Cost / Tender (£)</label>
<input id="base" type="number">

<label>Target Margin %</label>
<input id="margin" value="7.5" type="number">

<label>VAT %</label>
<input id="vat" value="20" type="number">

<label>
<input type="checkbox" id="vatToggle"> Add VAT
</label>

<label>Fee Sensitivity</label>
<input type="range" min="0" max="25" value="7.5" class="slider" id="slider">

<div class="result">
Sell Price: <span id="sell"></span><br>
Net Cost: <span id="costOut"></span><br>
Profit: <span id="profit"></span><br>
Margin: <span id="marginOut"></span><br>
Markup: <span id="markupOut"></span><br>
Break Even: <span id="breakeven"></span>
</div>

<button onclick="saveProject()">Save Project</button>
<button onclick="exportPDF()">Export PDF</button>
<button onclick="toggleDark()">Dark Mode</button>

</div>

<div class="card">
<h3>Saved Projects</h3>
<ul id="projects"></ul>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>

const { jsPDF } = window.jspdf;

function calc(){
let base=parseFloat(document.getElementById("base").value)||0;
let m=parseFloat(document.getElementById("margin").value)/100||0;
let vat=parseFloat(document.getElementById("vat").value)/100||0;
let mode=document.getElementById("mode").value;

let sell=0,cost=0;

if(mode==="forward"){
cost=base;
sell=cost/(1-m);
}else{
sell=base;
cost=sell*(1-m);
}

let profit=sell-cost;
let markup=(profit/cost)*100;
let margin=(profit/sell)100;
let breakeven=cost;

if(document.getElementById("vatToggle").checked){
sell=sell(1+vat);
}

document.getElementById("sell").innerText="£"+sell.toFixed(2);
document.getElementById("costOut").innerText="£"+cost.toFixed(2);
document.getElementById("profit").innerText="£"+profit.toFixed(2);
document.getElementById("marginOut").innerText=margin.toFixed(2)+"%";
document.getElementById("markupOut").innerText=markup.toFixed(2)+"%";
document.getElementById("breakeven").innerText="£"+breakeven.toFixed(2);
}

document.querySelectorAll("input,select")
.forEach(el=>el.addEventListener("input",calc));

slider.oninput=()=>{margin.value=slider.value;calc();}

function saveProject(){
let list=JSON.parse(localStorage.getItem("projects")||"[]");
list.push(base.value+" @ "+margin.value+"%");
localStorage.setItem("projects",JSON.stringify(list));
loadProjects();
}

function loadProjects(){
let list=JSON.parse(localStorage.getItem("projects")||"[]");
projects.innerHTML="";
list.forEach(p=>{
let li=document.createElement("li");
li.innerText=p;
projects.appendChild(li);
});
}
loadProjects();

function exportPDF(){
let doc=new jsPDF();
doc.text("Evalu8 Pre-Construction Services Ltd",20,20);
doc.text("Sell: "+document.getElementById("sell").innerText,20,40);
doc.text("Profit: "+document.getElementById("profit").innerText,20,50);
doc.save("Evalu8_Tender.pdf");
}

function toggleDark(){
document.body.classList.toggle("dark");
}

</script>
</body>
</html>
